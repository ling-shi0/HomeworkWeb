<!DOCTYPE html>
<html lang="en" class="no-js">
<!-- 开始head -->
<head>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript" defer="defer">
	function addBasePath(){
		//1.得到项目根路径：http://localhost:8080/myproject/
		var curWwwPath = window.document.location.href;
		var pathName = window.document.location.pathname;
		var pos = curWwwPath.indexOf(pathName);
		var localhostPaht = curWwwPath.substring(0,pos);
		var projectName = pathName.substring(0,pathName.substr(1).indexOf('/')+1);
		var realPath = localhostPaht + projectName;
		var basePath = realPath + '/';
		console.log(basePath);
		
		//2.添加根路径到html的base标签中
		var $base = '<base href="' + basePath + '">';
		$('head').prepend($base); //在头部添加
	}
	addBasePath();
</script>
<meta charset="utf-8"/>
<title>学生主页</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- 0.最先：引入CSS -->
<!-- 开始全局强制样式 -->
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<!-- 结束全局强制样式 -->
<!-- 开始页级插件样式 -->
<link href="assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/jqvmap/jqvmap/jqvmap.css" rel="stylesheet" type="text/css"/>
<link href="assets/global/plugins/morris/morris.css" rel="stylesheet" type="text/css">
<!-- 结束页级插件样式 -->
<!-- 开始页面样式 -->
<link href="assets/admin/pages/css/tasks.css" rel="stylesheet" type="text/css"/>
<!-- 结束页面样式 -->
<!-- 开始主题样式 -->
<link href="assets/global/css/components-rounded.css" id="style_components" rel="stylesheet" type="text/css"/>
<link href="assets/global/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="assets/admin/layout4/css/layout.css" rel="stylesheet" type="text/css"/>
<link href="assets/admin/layout4/css/themes/light.css" rel="stylesheet" type="text/css" id="style_color"/>
<link href="assets/admin/layout4/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="app/img/favicon.ico" rel="shortcut icon" />
<!-- 结束主题样式 -->
</head>
<!-- 结束head -->
<!-- 开始body -->
<body class="page-header-fixed page-sidebar-closed-hide-logo page-sidebar-closed-hide-logo">

<!-- 1.开始顶部div -->
<div class="page-header navbar navbar-fixed-top">
	
	<!-- 1.1开始顶部内容 -->
	<div class="page-header-inner">
		
		<!-- 开始LOGO -->
		<div class="page-logo">
			<a href="/HomeWorkWeb/student/index">
				<img src="assets/admin/layout4/img/logo-light.png" alt="logo" class="logo-default"/>
			</a>
			<div class="menu-toggler sidebar-toggler">
				<!-- 文档说明：删除上面的“隐藏”以启用标题上的边栏切换按钮 -->
			</div>
		</div>
		<!-- 结束LOGO -->

		<!-- 开始响应菜单切换 -->
		<a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse">
		</a>
		<!-- 结束响应菜单切换 -->
		
		<!-- 开始页顶端 -->
		<div class="page-top">
			
			<!-- 开始标题搜索框 -->
			<form class="search-form" action="extra_search.html" method="GET">
				<div class="input-group">
					<input type="text" class="form-control input-sm" placeholder="Search..." name="query">
					<span class="input-group-btn">
					<a href="javascript:;" class="btn submit"><i class="icon-magnifier"></i></a>
					</span>
				</div>
			</form>
			<!-- 结束标题搜索框 -->

			<!-- 开始顶部导航菜单 -->
			<div class="top-menu">
				<ul class="nav navbar-nav pull-right">
					<li class="separator hide">
					</li>
					<!-- 开始通知下拉列表 -->
					<li class="dropdown dropdown-extended dropdown-notification dropdown-dark" id="header_notification_bar">
						<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
						<i class="icon-bell"></i>
						<span class="badge badge-success">
						7 </span>
						</a>
						<ul class="dropdown-menu">
							<li class="external">
								<h3><span class="bold">7 个待定</span> 通知</h3>
								<a href="extra_profile.html">view all</a>
							</li>
							<li>
								<ul class="dropdown-menu-list scroller" style="height: 250px;" data-handle-color="#637283">
									<li>
										<a href="javascript:;">
										<span class="time">just now</span>
										<span class="details">
										<span class="label label-sm label-icon label-success">
										<i class="fa fa-plus"></i>
										</span>
										New user registered. </span>
										</a>
									</li>
									<li>
										<a href="javascript:;">
										<span class="time">3 mins</span>
										<span class="details">
										<span class="label label-sm label-icon label-danger">
										<i class="fa fa-bolt"></i>
										</span>
										Server #12 overloaded. </span>
										</a>
									</li>
									<li>
										<a href="javascript:;">
										<span class="time">10 mins</span>
										<span class="details">
										<span class="label label-sm label-icon label-warning">
										<i class="fa fa-bell-o"></i>
										</span>
										Server #2 not responding. </span>
										</a>
									</li>
									<li>
										<a href="javascript:;">
										<span class="time">14 hrs</span>
										<span class="details">
										<span class="label label-sm label-icon label-info">
										<i class="fa fa-bullhorn"></i>
										</span>
										Application error. </span>
										</a>
									</li>
									<li>
										<a href="javascript:;">
										<span class="time">2 days</span>
										<span class="details">
										<span class="label label-sm label-icon label-danger">
										<i class="fa fa-bolt"></i>
										</span>
										Database overloaded 68%. </span>
										</a>
									</li>
								</ul>
							</li>
						</ul>
					</li>
					<!-- 结束通知下拉列表 -->

					<!-- 开始用户登录下拉列表 -->
					<li class="dropdown dropdown-user dropdown-dark">
						<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
						<span id="userName" class="username username-hide-on-mobile">
							<!-- 此处展示用户名 -->
						</span>
						<!-- DOC: Do not remove below empty space(&nbsp;) as its purposely used -->
						<img alt="" class="img-circle" src="assets/admin/layout4/img/avatar9.jpg"/>
						</a>
						<ul class="dropdown-menu dropdown-menu-default">
							<li>
								<a href="extra_profile.html">
								<i class="icon-user"></i> 我的信息 </a>
							</li>
							
							<li>
								<a href="page_calendar.html">
								<i class="icon-calendar"></i> 我的日历 </a>
							</li>
							
							<li class="divider">
							</li>
							
							<li>
								<a href="extra_lock.html">
								<i class="icon-lock"></i> 锁屏 </a>
							</li>
							
							<li>
								<a href="/HomeWorkWeb/logout">
									<i class="icon-key"></i>
									退出登录
								</a>
							</li>
						</ul>
					</li>
					<!-- 结束用户登录下拉列表 -->
				</ul>
			</div>
			<!-- 结束顶部导航菜单 -->
		</div>
		<!-- 结束页顶端 -->
	</div>
	<!-- 1.1结束顶部内容 -->
</div>
<!-- 1.结束顶部div -->

<div class="clearfix">
</div>

<!-- 2.开始中间容器 -->
<div class="page-container">
	<!-- 2.1开始提要栏 -->
	<div class="page-sidebar-wrapper">
		<div class="page-sidebar navbar-collapse collapse">
			<!-- 开始侧边栏菜单 -->
			<ul id="menulist" class="page-sidebar-menu " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
				<li class="start active">
					<a href="/HomeWorkWeb/announcement/index">
						<i class="icon-home"></i>
						<span class="title">公告管理</span>
					</a>
				</li>
				
				<li>
					<a href="javascript:;">
						<i class="icon-basket"></i>
						<span class="title">课程管理</span>
						<span class="arrow"></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="javascript:void(0);" onclick="loadPage('/HomeWorkWeb/student/courseChoosed')">
							已选课程</a>
						</li>
						<li>
							<a href="javascript:void(0);" onclick="loadPage('/HomeWorkWeb/student/courseOfCollege')">
							本院已开课程</a>
						</li>
					</ul>
				</li>
				
				<li>
					<a href="javascript:;">
						<i class="icon-rocket"></i>
						<span class="title">作业管理</span>
						<span class="arrow"></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="javascript:void(0);" onclick="loadPage('/HomeWorkWeb/student/workChoosed')">
							已选作业</a>
						</li>
						<li>
							<a href="javascript:void(0);" onclick="loadPage('/HomeWorkWeb/student/OtherPublishWork')">
							他人公布的作业</a>
						</li>
					</ul>
				</li>
				
				<li>
					<a href="javascript:;">
						<i class="icon-diamond"></i>
						<span class="title">评论管理</span>
						<span class="arrow "></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="javascript:void(0);" onclick="loadPage('/HomeWorkWeb/student/commentByMe')">
							我的历史评论</a>
						</li>
						<li>
							<a href="javascript:void(0);" onclick="loadPage('/HomeWorkWeb/student/commentAboutMe')">
							关于我的评论</a>
						</li>
					</ul>
				</li>
				
				<li>
					<a href="javascript:;">
						<i class="icon-puzzle"></i>
						<span class="title">我的老师</span>
						<span class="arrow "></span>
					</a>
					<ul class="sub-menu">
						<li>
							<a href="javascript:void(0);" onclick="loadPage('/HomeWorkWeb/student/teacherChoosed')">
							已选课程教师</a>
						</li>
						<li>
							<a href="javascript:void(0);" onclick="loadPage('/HomeWorkWeb/student/teacherOfCollege')">
							本院开课教师</a>
						</li>
					</ul>
				</li>
				
				<li class="tooltips" data-container="body" data-placement="right" data-html="true">
					<a href="javascript:void(0);" onclick="loadPage('/HomeWorkWeb/student/aboutUs')">
						<i class="icon-paper-plane"></i>
						<span class="title">
						联系我们</span>
					</a>
				</li>
			</ul>
			<!-- 结束侧边栏菜单 -->
		</div>
	</div>
	<!-- 2.1结束提要栏 -->

	<!-- 2.2开始内容 -->
	<div class="page-content-wrapper">
		<!-- ！！！！开始真实内容(可随时变化)！！！！ -->
		<div class="page-content" id="right">
			<!-- 开始页面内容内部 -->
			<div class="row">
				<div class="col-md-12 col-sm-12">
					<div class="portlet grey-cascade box">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-cogs"></i>
								<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有公告</font></font>
							</div>
							<div class="actions">
								<a href="javascript:;" class="btn btn-default btn-sm">
									<font id="newAnnouncementCount" style="vertical-align: inherit;">
										<!-- 此处由最新公告填写 -->
									</font>
								</a>
							</div>
						</div>
						<div class="portlet-body">
							<div class="table-responsive">
								<table id="task-list" class="table table-striped table-bordered table-advance table-hover">
									<!-- 说明：此处由JS动态插入 -->
								</table>
							</div>
							<div class="task-footer">
								<div class="btn-arrow-link">
									<ul id="paging" class="pagination">
										<!-- 此处内容由JS显示分页内容 -->
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 结束页内容内部 -->
		</div>
		<!-- ！！！！结束真实内容(可随时变化)！！！！ -->
	</div>
	<!-- 2.2结束内容 -->
</div>
<!-- 2.结束中间容器 -->

<!-- 3.开始页脚 -->
<div class="page-footer" style="text-align:center">
	2019-2020 &copy; 西安理工大学计算机学院和自动化学院著
	<a href="http://www.xaut.edu.cn/" target="_blank">西安理工大学</a>
</div>
<!-- 3.结束页脚 -->

<!-- 9999.最后：引入JS -->
<!-- 开始核心插件 -->
<script src="assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<!-- 结束核心插件 -->
<!-- 开始页级插件 -->
<script src="assets/global/plugins/jqvmap/jqvmap/jquery.vmap.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.russia.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.world.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.europe.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.germany.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.usa.js" type="text/javascript"></script>
<script src="assets/global/plugins/jqvmap/jqvmap/data/jquery.vmap.sampledata.js" type="text/javascript"></script>
<script src="assets/global/plugins/morris/morris.min.js" type="text/javascript"></script>
<script src="assets/global/plugins/morris/raphael-min.js" type="text/javascript"></script>
<script src="assets/global/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
<!-- 结束页级插件 -->
<!-- 开始页级脚本 -->
<script src="assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="assets/admin/layout4/scripts/layout.js" type="text/javascript"></script>
<script src="assets/admin/layout2/scripts/quick-sidebar.js" type="text/javascript"></script>
<script src="assets/admin/layout4/scripts/demo.js" type="text/javascript"></script>
<script src="assets/admin/pages/scripts/index3.js" type="text/javascript"></script>
<script src="assets/admin/pages/scripts/tasks.js" type="text/javascript"></script>
<!-- 结束页级脚本 -->
<!-- 开始自定义JS -->
<script>
/**
 * 重写方法,自定义格式化日期
 */
Date.prototype.toLocaleString = function() {
	// 补0   例如 2018/7/10 14:7:2  补完后为 2018/07/10 14:07:02
    function addZero(num) {
        if(num<10)
            return "0" + num;
        return num;
    }
    // 按自定义拼接格式返回
    return this.getFullYear() + "/" + addZero(this.getMonth() + 1) + "/" + addZero(this.getDate());
};

/**
 * function:展示用户名
 */
function showUserName(){
	 var userName = sessionStorage.getItem('userName');
	 console.log(userName);
	 
	 $.ajax({
	        url: '/HomeWorkWeb/student/findStudentNameByUsername',
	        type: 'GET',
	        async: false,
	        data: {
	        	userName: userName,
	        },
	        success: function (response) {
	        	console.log(response);
	        	$('#userName').html(response);
	        }
		})
};

/**
 * function:前端页面获取前端页面传来的参数
 */
function GetPar(name) {
	var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
	var r = window.location.search.substr(1).match(reg);
	if(r != null)
		return decodeURIComponent(r[2]);
	return null;
};

/**
 * function:重新回到自己页面
 */
function gotoIndex(currentPage,pageSize){
	var url = '/HomeWorkWeb/student/index';
	location.href = encodeURI(url + "?currentPage=" + currentPage + "&pageSize=" + pageSize);
};

/**
 * function:显示分页列表
 */
function showPage(response){
	var page_li = '';
	
	//1.输出首页和上一页
	if(response.currentPage == 1){ //当前是第一页，不能点击首页和上一页
		page_li += '<li><a href="javascript:;">首页</a></li>';
		page_li += '<li><a href="javascript:;">&laquo;</a></li>';
	}
	else{
		page_li += '<li><a href="javascript:void(0);" onclick="gotoIndex(' + (1) + ','  + response.data.pageSize + ')">首页</a></li>';
		page_li += '<li><a href="javascript:void(0);" onclick="gotoIndex(' + (response.data.currentPage-1) + ',' + response.data.pageSize + ')">&laquo;</a></li>';
	}
	
	//2.循环输出中间页码
	for(var i=response.data.start; i<response.data.start+response.data.pageNo; i++){
		if(i == response.data.currentPage){ //给当前页标记,进行区分
			page_li += '<li class="active"><a href="javascript:void(0);" onclick="gotoIndex(' + (i) + ',' + response.data.pageSize + ')">' + i + '&nbsp;&nbsp;</a></li>';
		}
		else{
			page_li += '<li><a href="javascript:void(0);" onclick="gotoIndex(' + (i) + ',' + response.data.pageSize + ')">' + i + '&nbsp;&nbsp;</a></li>';
		}
	}
	
	//3.输出下一页和末页
	if(response.data.currentPage == response.data.totalPage){ //当前是最后一页，不能点击末页和下一页
		page_li += '<li><a href="javascript:;">&raquo;</a></li>';
		page_li += '<li><a href="javascript:;">末页</a></li>';
	}
	else{
		page_li += '<li><a href="javascript:void(0);" onclick="gotoIndex(' + response.data.totalPage + ',' + response.data.pageSize + ')">末页</a></li>';
		page_li += '<li><a href="javascript:void(0);" onclick="gotoIndex(' + (response.data.currentPage+1) + ',' + response.data.pageSize + ')">&raquo;</a></li>';
	}
	
	//4.输出总页数
	page_li += '<li><a style="color:black">共' + response.data.totalPage + '页</a></li>';
	$("#paging").html(page_li);
}

/**
 * 展示公告列表
 */
var currentPage = 1; //默认当前页
var pageSize = 7; //默认页大小
function showAnnouncement(){
	//1.获得前端参数
	var a = GetPar('currentPage');
	var b = GetPar('pageSize');
	
	if(a!=null && b!=null){ //参数不为空时:使用本参数
		currentPage = a;
		pageSize = b;
	}
	
	//2.使用Ajax调用接口
	$.ajax({
        url: '/HomeWorkWeb/announcement/findAllAnnouncementByPage',
        type: 'GET',
        async: false,
        data: {
        	currentPage: currentPage,
        	pageSize: pageSize,
        },
        success: function (response) {
        	//2.1.显示公告
        	var ann_tr = '<thead><tr><th>公告名</th><th>状态</th><th>发布人</th><th>相关课程</th><th>发布时间</th><th></th><th></th></tr></thead>';
        	for(var i=0; i<response.data.list.length; i++){
        		ann_tr += '<tr><td><a href="javascript:;" class="primary-link">' + response.data.list[i].aName + '</a></td>';
        		
        		if(response.data.list[i].isRead == false){ //未读公告
        			ann_tr += '<td><span class="label label-sm label-danger">new</span></td>';
        		} else{ //已读公告
        			ann_tr += '<td></td>';
        		}
        		
        		ann_tr += '<td>' + '发布人' + '</td>';
        		ann_tr += '<td>' + '相关课程' + '</td>';
        		
        		ann_tr += '<td>' + new Date(response.data.list[i].occurTime).toLocaleString() + '</td>';
        		
        		if(response.data.list[i].isRead == false){ //未读公告
        			ann_tr += '<td><a href="javascript:;" class="primary-link">查看</a></td>';
            		ann_tr += '<td><a href="javascript:;" class="primary-link" onclick="toRead(this,\'' + response.data.list[i].ano + '\')">标记已读</a></td></tr>';
        		} else{ //已读公告
        			ann_tr += '<td><a href="javascript:;" class="primary-link">查看</a></td>';
        			ann_tr += '<td><a href="javascript:;">已读</a></td></tr>';
        		}
        	}
        	$("#task-list").html(ann_tr);
        	
        	//2.2.显示分页
    		showPage(response);
        }
	})
};

/**
 * function:切换导航栏内容
 */
function loadPage(url) {
	console.log(url);
	$("#right").load(url);
}

/**
 * function:左部导航栏操作
 */
$(document).ready(function () {
	//点击一级目录
	$('#menulist > li > a').click(function () {
		$('#menulist > li').removeClass('active'); //去除所有一级标题
		$('#menulist ul > li').removeClass('active'); //去除所有二级标题
		$('#menulist > li').removeClass('open'); //为了关闭一级标题
		$('#menulist li a span').removeClass('open'); //关闭所有二级标题箭头
		
		$('#menulist > li > ul').attr("style","display:none"); //隐藏二级标题
		$(this).parent().addClass('active'); //选中本级标题
	});
	
	//点击二级目录
	$('#menulist ul li > a').click(function () {
		$('#menulist > li').removeClass('active'); //去除所有一级标题
		$('#menulist ul > li').removeClass('active'); //去除所有二级标题
		
		$(this).parent().addClass('active'); //选中本级标题
		$(this).parent().parent().parent().addClass('active'); //选中一级标题
	});
});

/**
 * function:展示最新公告数
 */
function showNewAnnouncementCount(){
	$.ajax({
        url: '/HomeWorkWeb/announcement/countNewAnnouncement',
        type: 'GET',
        async: false,
        data: {},
        success: function (response) {
        	$("#newAnnouncementCount").text("最新公告：" + response + "个")
        }
	})
}

/**
 * function：标记已读
 */
function toRead(obj,ano){
	//1.html操作
	$(obj).removeAttr('onclick'); //并且禁止鼠标点击
	$(obj).text("已读"); //标记已读改为已读
	$(obj).parent().parent().find("td").eq(1).find("span").remove(); //去掉new
	
	//2.将数据库公告改为已读
	console.log(ano);
	$.ajax({
        url: '/HomeWorkWeb/announcement/announcementIsRead',
        type: 'GET',
        async: false,
        data: {
        	ano: ano,
        },
        success: function (response) {
        	if(response == true)
        	{
        		alert("标记成功");
        	}else{
        		alert("标记失败");
        	}        		
        }
	})
}

/**
 * 加载完成后初始化页面
 */
$(document).ready(function() {
	Metronic.init(); // 初始化核心组件
	Layout.init(); // 初始化布局
	QuickSidebar.init(); // 初始化快速侧边栏
	
	showUserName(); //初始化用户名
	showNewAnnouncementCount(); //展示最新公告数
	showAnnouncement();	//展示公告列表
});
</script>
<!-- 结束自定义JS -->
</body>
<!-- 结束body -->
</html>